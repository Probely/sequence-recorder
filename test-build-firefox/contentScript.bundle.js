(()=>{"use strict";let e,t;function n(n,o){if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===n.tagName.toLowerCase())return"html";const l={root:document.body,idName:e=>!0,className:e=>!0,tagName:e=>!0,attr:(e,t)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};e={...l,...o},t=function(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return e;if(e===t.root)return e.ownerDocument;return e}(e.root,l);let a=r(n,"all",(()=>r(n,"two",(()=>r(n,"one",(()=>r(n,"none")))))));if(a){const e=w(b(a,n));return e.length>0&&(a=e[0]),i(a)}throw new Error("Selector was not found.")}function r(t,n,r){let i=null,l=[],a=t,g=0;for(;a;){let t=p(s(a))||p(...c(a))||p(...u(a))||p(f(a))||[{name:"*",penalty:3}];const y=d(a);if("all"==n)y&&(t=t.concat(t.filter(h).map((e=>m(e,y)))));else if("two"==n)t=t.slice(0,1),y&&(t=t.concat(t.filter(h).map((e=>m(e,y)))));else if("one"==n){const[e]=t=t.slice(0,1);y&&h(e)&&(t=[m(e,y)])}else"none"==n&&(t=[{name:"*",penalty:3}],y&&(t=[m(t[0],y)]));for(let e of t)e.level=g;if(l.push(t),l.length>=e.seedMinLength&&(i=o(l,r),i))break;a=a.parentElement,g++}return i||(i=o(l,r)),!i&&r?r():i}function o(t,n){const r=w(y(t));if(r.length>e.threshold)return n?n():null;for(let e of r)if(a(e))return e;return null}function i(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){const o=e[r].level||0;n=t.level===o-1?`${e[r].name} > ${n}`:`${e[r].name} ${n}`,t=e[r]}return n}function l(e){return e.map((e=>e.penalty)).reduce(((e,t)=>e+t),0)}function a(e){const n=i(e);switch(t.querySelectorAll(n).length){case 0:throw new Error(`Can't select any node with this selector: ${n}`);case 1:return!0;default:return!1}}function s(t){const n=t.getAttribute("id");return n&&e.idName(n)?{name:"#"+CSS.escape(n),penalty:0}:null}function c(t){const n=Array.from(t.attributes).filter((t=>e.attr(t.name,t.value)));return n.map((e=>({name:`[${CSS.escape(e.name)}="${CSS.escape(e.value)}"]`,penalty:.5})))}function u(t){return Array.from(t.classList).filter(e.className).map((e=>({name:"."+CSS.escape(e),penalty:1})))}function f(t){const n=t.tagName.toLowerCase();return e.tagName(n)?{name:n,penalty:2}:null}function d(e){const t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function m(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function h(e){return"html"!==e.name&&!e.name.startsWith("#")}function p(...e){const t=e.filter(g);return t.length>0?t:null}function g(e){return null!=e}function*y(e,t=[]){if(e.length>0)for(let n of e[0])yield*y(e.slice(1,e.length),t.concat(n));else yield t}function w(e){return[...e].sort(((e,t)=>l(e)-l(t)))}function*b(t,n,r={counter:0,visited:new Map}){if(t.length>2&&t.length>e.optimizedMinLength)for(let o=1;o<t.length-1;o++){if(r.counter>e.maxNumberOfTries)return;r.counter+=1;const l=[...t];l.splice(o,1);const s=i(l);if(r.visited.has(s))return;a(l)&&v(l,n)&&(yield l,r.visited.set(s,!0),yield*b(l,n,r))}}function v(e,n){return t.querySelector(i(e))===n}function N(e,t){let n="",r=null,o=!1;try{if(r=e.nodeName&&"string"==typeof e.nodeName?e.nodeName.toLowerCase():null,!r)return null;n=`${r}`,e.getAttribute("id")&&(n=`${n}#${CSS.escape(e.getAttribute("id"))}`,o=!0);const t=["data-test-id","data-testid","data-test","data-cy"];if(e.matches(t.map((e=>`[${e}]`)).join(",")))for(const r of t){const t=e.getAttribute(r);if(t){n=`${n}[${r}="${CSS.escape(t)}"]`;break}}if(["input","button","textarea","select","option"].includes(r)){e.getAttribute("type")&&(n=`${n}[type="${CSS.escape(e.getAttribute("type"))}"]`),e.getAttribute("name")&&(n=`${n}[name="${CSS.escape(e.getAttribute("name"))}"]`);const t=e.closest("form");if(t){let e="form";t.getAttribute("id")&&(e=`${e}#${CSS.escape(t.getAttribute("id"))}`),n=`${e} ${n}`}}const i=e.getAttribute("aria-label");if(i&&!o&&(n=`${n}[aria-label="${CSS.escape(i)}"]`),n){const t=e.closest("body");if(t)try{1!==t.querySelectorAll(n).length&&(n="")}catch(e){n=""}}}catch(e){}return n}function E(e,t){let n,r=e,o=[];for(;r;){let e=0,n=r.previousElementSibling;for(;n;)n.nodeName===r.nodeName&&e++,n=n.previousElementSibling;let i=r.nodeName.toLowerCase();e>0&&(i=i+"["+(e+1)+"]"),r!==t&&o.unshift(i),r=r.parentNode}if(n="/"+o.join("/"),function(e,t){const n=t.evaluate(e,t,null,XPathResult.ANY_TYPE,null),r=n.iterateNext();return r}(n,t)===e)return n}const S={},C={keydown:null,return:null,blur:null,change:null,click:null,dblclick:null,contextmenu:null,focus:null,mouseover:null,mouseout:null};let $=!1;function A(e,t){let n;var r;let o,i;function l(e,t,r){let i=null;const l=[];let s=e,c=0;for(;s&&s!==o.root.parentElement;){let e=w(f(s))||w(...d(s))||w(...m(s))||w(h(s))||[{name:"*",penalty:3}];const u=p(s);if(t===n.All)u&&(e=e.concat(e.filter(y).map((e=>g(e,u)))));else if(t===n.Two)e=e.slice(0,1),u&&(e=e.concat(e.filter(y).map((e=>g(e,u)))));else if(t===n.One){const[t]=e=e.slice(0,1);u&&y(t)&&(e=[g(t,u)])}for(const t of e)t.level=c;if(l.push(e),l.length>=o.seedMinLength&&(i=a(l,r),i))break;s=s.parentElement,c++}return i||(i=a(l,r)),i}function a(e,t){const n=N(v(e));if(n.length>o.threshold)return t?t():null;for(const e of n)if(u(e))return e;return null}function s(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){const o=e[r].level||0;n=t.level===o-1?`${e[r].name} > ${n}`:`${e[r].name} ${n}`,t=e[r]}return n}function c(e){return e.map((e=>e.penalty)).reduce(((e,t)=>e+t),0)}function u(e){switch(i.querySelectorAll(s(e)).length){case 0:throw new Error(`Can't select any node with this selector: ${s(e)}`);case 1:return!0;default:return!1}}function f(e){const t=e.getAttribute("id");return t&&o.idName(t)?{name:`#${L(t,{isIdentifier:!0})}`,penalty:0}:null}function d(e){return Array.from(e.attributes).filter((e=>o.attr(e.name,e.value))).map((e=>({name:"["+L(e.name,{isIdentifier:!0})+'="'+L(e.value)+'"]',penalty:.5})))}function m(e){return Array.from(e.classList).filter(o.className).map((e=>({name:"."+L(e,{isIdentifier:!0}),penalty:1})))}function h(e){const t=e.tagName.toLowerCase();return o.tagName(t)?{name:t,penalty:2}:null}function p(e){const t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function g(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function y(e){return"html"!==e.name&&!e.name.startsWith("#")}function w(...e){const t=e.filter(b);return 0<t.length?t:null}function b(e){return null!=e}function*v(e,t=[]){if(0<e.length)for(const n of e[0])yield*v(e.slice(1,e.length),t.concat(n));else yield t}function N(e){return Array.from(e).sort(((e,t)=>c(e)-c(t)))}function E(e,t){return i.querySelector(s(e))===t}(r=n||(n={}))[r.All=0]="All",r[r.Two=1]="Two",r[r.One=2]="One";const S=/[ -,\.\/:-@\[-\^`\{-~]/,C=/[ -,\.\/:-@\[\]\^`\{-~]/,$=/(^|\\+)?(\\[A-F0-9]{1,6})\x20(?![a-fA-F0-9\x20])/g,A={escapeEverything:!1,isIdentifier:!1,quotes:"single",wrap:!1};function L(e,t={}){const n=Object.assign(Object.assign({},A),t);"single"!==n.quotes&&"double"!==n.quotes&&(n.quotes="single");const r="double"==n.quotes?'"':"'",o=n.isIdentifier,i=e.charAt(0);let l="",a=0;for(const t=e.length;a<t;){const i=e.charAt(a++);let s,c=i.charCodeAt(0);if(32>c||126<c){if(55296<=c&&56319>=c&&a<t){const t=e.charCodeAt(a++);56320==(64512&t)?c=((1023&c)<<10)+(1023&t)+65536:a--}s="\\"+c.toString(16).toUpperCase()+" "}else s=n.escapeEverything?S.test(i)?"\\"+i:"\\"+c.toString(16).toUpperCase()+" ":/[\t\n\f\r\x0B]/.test(i)?"\\"+c.toString(16).toUpperCase()+" ":"\\"==i||!o&&('"'==i&&r==i||"'"==i&&r==i)||o&&C.test(i)?"\\"+i:i;l+=s}return o&&(/^-[-\d]/.test(l)?l="\\-"+l.slice(1):/\d/.test(i)&&(l="\\3"+i+" "+l.slice(1))),l=l.replace($,(function(e,t,n){return t&&t.length%2?e:(t||"")+n})),!o&&n.wrap?r+l+r:l}if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===e.tagName.toLowerCase())return"html";const T={root:document.body,idName:()=>!0,className:()=>!0,tagName:()=>!0,attr:()=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};o=Object.assign(Object.assign({},T),t),i=function(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}(o.root,T);let x=l(e,n.All,(()=>l(e,n.Two,(()=>l(e,n.One)))));if(x){const t=N(function*e(t,n,r={counter:0,visited:new Map}){if(2<t.length&&t.length>o.optimizedMinLength)for(let i=1;i<t.length-1;i++){if(r.counter>o.maxNumberOfTries)return;r.counter+=1;const l=[...t];l.splice(i,1);const a=s(l);if(r.visited.has(a))return;u(l)&&E(l,n)&&(yield l,r.visited.set(a,!0),yield*e(l,n,r))}}(x,e));return 0<t.length&&(x=t[0]),s(x)}throw new Error("Selector was not found.")}!function(){let e=document.title,t=!1,r=!1,o=!1;chrome&&chrome.storage.sync.get(["isRecording"],(i=>{if(!i.isRecording)return;let l=!1,a=null;function s(e){e&&"mouseover"===e.type&&!l||function(e,t,r,o){let i=!1,l=null,a=null;e&&e.composed&&e.composedPath&&(a=e.composedPath());let s=-1;a&&a.length>0&&(s=a.findIndex((e=>e instanceof ShadowRoot))),l=s>-1?a[0]:e.target;const c=e.type;let u=null,f=null;if(!l||!l.getAttribute)return;u=l.nodeName.toLowerCase(),f=l.getAttribute("type");let d=null,m=null;try{m=function(e){let t=null;try{if(t=e.nodeName&&"string"==typeof e.nodeName?e.nodeName.toLowerCase():null,!t)return e;if(["input","button","a","textarea","select","option","progress"].includes(t))return e;const n=e.closest("button,a");if(n)return n;const r=e.closest("svg");r&&(e=r);const o=["data-test-id","data-testid","data-test","data-cy"];if(e.matches(o.map((e=>`[${e}]`)).join(",")))return e;if(e.parentNode.matches(o.map((e=>`[${e}]`)).join(",")))return e.parentNode}catch(e){}return e}(l),d=N(m)}catch(e){}if(!d)try{d=n(m,{root:t,idName:e=>!/^[0-9]+.*/i.test(e),className:e=>!e.includes("focus")&&!e.includes("highlight")&&!/^[0-9]+.*/i.test(e)})}catch(e){}if(d&&"html"===d.toLowerCase())return;let h=null;try{h=E(m,t)}catch(e){}s>-1&&(h="/html/node/shadow");let p={timestamp:(new Date).getTime(),css:d||l,xpath:h||""},g={};if("click"===c){if(C.click=l,!(C.return!==C.change||l===C.return||"input"!==u&&"button"!==u||"submit"!==f&&"image"!==f||null===C.return))return;if("input"===u&&("checkbox"===f||"radio"===f))return;if("label"===u){const e=l.getAttribute("for");if(e&&document.getElementById(e))return}let o="click";if("canvas"===u){const t=l.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top,width:t.width,height:t.height};p={...p,coords:n},o="bclick"}if(g={...p,type:o,value:(l.value||l.textContent||"").trim().substr(0,20).replace(/\n/gi,""),frame:r},"bclick"===o&&s>-1&&a){const e=a[s].host;if(e){let r=null;try{r=N(e)}catch(e){}if(!r)try{r=n(e,{root:t,idName:e=>!/^[0-9]+.*/i.test(e),className:e=>!e.includes("focus")&&!e.includes("highlight")&&!/^[0-9]+.*/i.test(e)})}catch(e){}r&&(g.shadow_host_css=r)}}}else if("dblclick"===c)C.dblclick=l,g={...p,type:"dblclick",value:(l.value||l.textContent||"").trim().substr(0,20).replace(/\n/gi,""),frame:r};else if("contextmenu"===c)C.contextmenu=l,g={...p,type:"contextmenu",value:(l.value||l.textContent||"").trim().substr(0,20).replace(/\n/gi,""),frame:r};else if("focus"===c);else if("mouseover"===c)$&&(clearTimeout($),$=!1),$=setTimeout((()=>{$=!1,C.mouseover=l,g={...p,type:"mouseover",value:(l.value||l.textContent||"").trim().substr(0,20).replace(/\n/gi,""),frame:r},g&&g.type&&o&&o({messageType:"events",event:{...g}})}),500);else if("mouseout"===c);else if("keydown"===c)C.keydown=l,["input","textarea"].indexOf(u)>-1&&(S[l]=l.value),"input"===u&&13===e.keyCode&&(i=!0,C.return=l,g={...p,type:"fill_value",value:l.value,frame:r});else if("blur"===c){if(C.blur=l,["input","textarea"].indexOf(u)>-1){if(S[l]=l.value,l===C.return)return void(C.return=null);if("input"===u&&("submit"===l.type||"button"===l.type||"image"===l.type))return;g={...p,type:"fill_value",value:l.value,frame:r}}}else if("change"===c)if(C.change=l,"input"===u)"checkbox"!==f&&"radio"!==f||(g={...p,type:"change",subtype:"check",checked:l.checked,frame:r});else if("select"===u)if(l.multiple){const e=[];for(let t=0;t<l.options.length;t++)e.push(!!l.options[t].selected);g={...p,type:"change",subtype:"select_multi",selected:[].concat(e),value:l.value,frame:r}}else{const e=l.selectedIndex;g={...p,type:"change",subtype:"select",selected:e,value:l.value,frame:r}}if(g&&g.type&&o&&o({messageType:"events",event:{...g}}),i&&o){const e={...p,timestamp:(new Date).getTime(),type:"press_key",value:13,frame:r};o({messageType:"events",event:{...e}})}}(e,window.document,null,(e=>{window!==window.top?window.parent.postMessage({source:"event-from-iframe",obj:{...e},framePath:[]},"*"):chrome.runtime.sendMessage(e)}))}window===window.top&&window.addEventListener("message",(e=>{if(e.data&&e.data.source&&"event-from-iframe"===e.data.source){const t=document.querySelectorAll("iframe, frame");let n=!1;for(const r of t)if(r.contentWindow===e.source){n=!0;break}if(!n)return;const r={...e.data.obj},o=e.data.framePath||[];for(const n of t)if(n.contentWindow===e.source){let e=null;try{e=N(n)}catch(e){}if(!e)try{e=A(n,{root:window.document,idName:e=>!/^[0-9]+.*/i.test(e),className:e=>!e.includes("focus")&&!e.includes("highlight")&&!/^[0-9]+.*/i.test(e)})}catch(e){}if(e&&r.event){const t=[e,...o];r.event.frame=t.join(" >>> "),chrome.runtime.sendMessage(r)}break}}})),window!==window.top&&window.addEventListener("message",(e=>{if(e.data&&e.data.source&&"event-from-iframe"===e.data.source){const t=document.querySelectorAll("iframe, frame");let n=!1;for(const r of t)if(r.contentWindow===e.source){n=!0;break}if(!n)return;const r=e.data.framePath||[];for(const n of t)if(n.contentWindow===e.source){let t=null;try{t=N(n)}catch(e){}if(!t)try{t=A(n,{root:window.document,idName:e=>!/^[0-9]+.*/i.test(e),className:e=>!e.includes("focus")&&!e.includes("highlight")&&!/^[0-9]+.*/i.test(e)})}catch(e){}t&&r.push(t),window.parent.postMessage({source:"event-from-iframe",obj:e.data.obj,framePath:r},"*");break}}})),i.isRecording&&(t=!0,e=document.title,function(){if(!t)return document.title=`${e}`,o=!1,void(r&&(clearInterval(r),r=!1));r=setInterval((()=>{o?(document.title=`${e}`,o=!1):(document.title=`ðŸ”´ ${e}`,o=!0)}),1e3)}(),window===window.top&&chrome.runtime.sendMessage({messageType:"events",event:{type:"goto",timestamp:(new Date).getTime(),windowWidth:window.innerWidth,windowHeight:window.innerHeight,url:window.location.href}}),document.addEventListener("click",s,!0),document.addEventListener("mouseover",s,!0),document.addEventListener("dblclick",s,!0),document.addEventListener("contextmenu",s,!0),document.addEventListener("keydown",s,!0),document.addEventListener("blur",s,!0),document.addEventListener("change",s,!0));const c={attributes:!1,childList:!0,subtree:!0},u=new MutationObserver((async(e,t)=>{l=!0,a&&(clearTimeout(a),a=null),a=setTimeout((()=>{l=!1}),200)}));document.body&&u.observe(document.body,c)}))}()})();